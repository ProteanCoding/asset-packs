eval('var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __metadata = (this && this.__metadata) || function (k, v) {\r\n    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);\r\n};\r\nvar __values = (this && this.__values) || function(o) {\r\n    var s = typeof Symbol === "function" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === "number") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? "Object is not iterable." : "Symbol.iterator is not defined.");\r\n};\r\nvar __assign = (this && this.__assign) || function () {\r\n    __assign = Object.assign || function(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n                t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\ndefine("e7a6c753-ea84-4c8e-bb94-4523407a5d55/bubble", ["require", "exports"], function (require, exports) {\r\n    "use strict";\r\n    Object.defineProperty(exports, "__esModule", { value: true });\r\n    var MessageBubbleComponent = /** @class */ (function () {\r\n        function MessageBubbleComponent(channel, text, rotation) {\r\n            this.channel = channel;\r\n            this.transition = -1;\r\n            this.isOpen = false;\r\n            this.text = text;\r\n            this.rotation = rotation;\r\n        }\r\n        MessageBubbleComponent = __decorate([\r\n            Component(\'org.decentraland.MessageBubble\'),\r\n            __metadata("design:paramtypes", [Object, String, Quaternion])\r\n        ], MessageBubbleComponent);\r\n        return MessageBubbleComponent;\r\n    }());\r\n    exports.MessageBubbleComponent = MessageBubbleComponent;\r\n    var openBubble = new Vector3(2, 2, 2);\r\n    var closedBubble = new Vector3(0.25, 0.25, 0.25);\r\n    var BubbleSystem = /** @class */ (function () {\r\n        function BubbleSystem() {\r\n            this.group = engine.getComponentGroup(MessageBubbleComponent);\r\n        }\r\n        BubbleSystem.prototype.update = function (dt) {\r\n            var e_1, _a;\r\n            try {\r\n                for (var _b = __values(this.group.entities), _c = _b.next(); !_c.done; _c = _b.next()) {\r\n                    var entity = _c.value;\r\n                    var openable = entity.getComponent(MessageBubbleComponent);\r\n                    var transform = entity.getComponent(Transform);\r\n                    var start = openable.isOpen ? closedBubble : openBubble;\r\n                    var end = openable.isOpen ? openBubble : closedBubble;\r\n                    var speed = openable.isOpen ? 1 : 2;\r\n                    if (openable.transition >= 0 && openable.transition < 1) {\r\n                        openable.transition += dt * speed;\r\n                        transform.scale.copyFrom(Vector3.Lerp(start, end, openable.transition));\r\n                    }\r\n                    else if (openable.transition > 1) {\r\n                        openable.transition = -1;\r\n                        transform.scale.copyFrom(end);\r\n                        // send actions\r\n                        // if (openable.isOpen && openable.onOpen) {\r\n                        //   openable.channel.sendActions(openable.onOpen)\r\n                        // } else if (!openable.isOpen && openable.onClose) {\r\n                        //   openable.channel.sendActions(openable.onClose)\r\n                        // }\r\n                    }\r\n                    else if (!openable.isOpen) {\r\n                        transform.rotate(new Vector3(0, 1, 0), 1);\r\n                    }\r\n                }\r\n            }\r\n            catch (e_1_1) { e_1 = { error: e_1_1 }; }\r\n            finally {\r\n                try {\r\n                    if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\r\n                }\r\n                finally { if (e_1) throw e_1.error; }\r\n            }\r\n        };\r\n        return BubbleSystem;\r\n    }());\r\n    exports.BubbleSystem = BubbleSystem;\r\n});\r\n/// <reference path="./types.d.ts" />\r\ndefine("e7a6c753-ea84-4c8e-bb94-4523407a5d55/node_modules/decentraland-builder-scripts/channel", ["require", "exports"], function (require, exports) {\r\n    "use strict";\r\n    Object.defineProperty(exports, "__esModule", { value: true });\r\n    var REQUEST_VALUE = \'__request_value__\';\r\n    var REPLY_VALUE = \'__reply_value__\';\r\n    var POLL_INTERVAL = 5000;\r\n    function createChannel(id, host, bus) {\r\n        var handlers = {};\r\n        var requests = {};\r\n        var responses = {};\r\n        bus.on(host.name, function (action) {\r\n            var handler = handlers[action.actionId];\r\n            if (handler) {\r\n                handler(action);\r\n            }\r\n            // clear all pending requests for this entity\r\n            requests = {};\r\n        });\r\n        bus.on(REQUEST_VALUE, function (message) {\r\n            if (message.sender !== id && message.entityName === host.name) {\r\n                var key = message.key;\r\n                var response = responses[key];\r\n                if (response) {\r\n                    var value = response();\r\n                    var reply = {\r\n                        entityName: host.name,\r\n                        key: key,\r\n                        sender: id,\r\n                        value: value\r\n                    };\r\n                    bus.emit(REPLY_VALUE, reply);\r\n                }\r\n                // clear pending request for this key\r\n                delete requests[key];\r\n            }\r\n        });\r\n        bus.on(REPLY_VALUE, function (message) {\r\n            if (message.sender !== id && message.entityName === host.name) {\r\n                var key = message.key, value = message.value;\r\n                var request = requests[key];\r\n                if (request) {\r\n                    request(value);\r\n                }\r\n                // clear pending request for this key\r\n                delete requests[key];\r\n            }\r\n        });\r\n        return {\r\n            id: id,\r\n            bus: bus,\r\n            createAction: function (actionId, values) {\r\n                var action = {\r\n                    entityName: host.name,\r\n                    actionId: actionId,\r\n                    values: values\r\n                };\r\n                return action;\r\n            },\r\n            sendActions: function (actions) {\r\n                var e_2, _a;\r\n                if (actions === void 0) { actions = []; }\r\n                try {\r\n                    for (var actions_1 = __values(actions), actions_1_1 = actions_1.next(); !actions_1_1.done; actions_1_1 = actions_1.next()) {\r\n                        var base = actions_1_1.value;\r\n                        var action = __assign(__assign({}, base), { sender: id });\r\n                        bus.emit(action.entityName, action);\r\n                    }\r\n                }\r\n                catch (e_2_1) { e_2 = { error: e_2_1 }; }\r\n                finally {\r\n                    try {\r\n                        if (actions_1_1 && !actions_1_1.done && (_a = actions_1.return)) _a.call(actions_1);\r\n                    }\r\n                    finally { if (e_2) throw e_2.error; }\r\n                }\r\n            },\r\n            handleAction: function (actionId, handler) {\r\n                handlers[actionId] = handler;\r\n            },\r\n            request: function (key, callback) {\r\n                requests[key] = callback;\r\n                var request = { entityName: host.name, key: key, sender: id };\r\n                var interval = setInterval(function () {\r\n                    if (key in requests) {\r\n                        bus.emit(REQUEST_VALUE, request);\r\n                    }\r\n                    else {\r\n                        clearInterval(interval);\r\n                    }\r\n                }, POLL_INTERVAL);\r\n            },\r\n            reply: function (key, callback) {\r\n                responses[key] = callback;\r\n            }\r\n        };\r\n    }\r\n    exports.createChannel = createChannel;\r\n});\r\n/// <reference path="./types.d.ts" />\r\ndefine("e7a6c753-ea84-4c8e-bb94-4523407a5d55/node_modules/decentraland-builder-scripts/spawner", ["require", "exports", "node_modules/decentraland-builder-scripts/channel"], function (require, exports, channel_1) {\r\n    "use strict";\r\n    Object.defineProperty(exports, "__esModule", { value: true });\r\n    var bus = new MessageBus();\r\n    var Spawner = /** @class */ (function () {\r\n        function Spawner(script) {\r\n            script.init();\r\n            this.script = script;\r\n        }\r\n        Spawner.prototype.spawn = function (name, transform, props) {\r\n            if (transform === void 0) { transform = new Transform({ position: new Vector3(8, 0, 8) }); }\r\n            var host = new Entity(name);\r\n            host.addComponent(transform);\r\n            engine.addEntity(host);\r\n            var channel = channel_1.createChannel(\'channel-id\', host, bus);\r\n            this.script.spawn(host, props || {}, channel);\r\n        };\r\n        return Spawner;\r\n    }());\r\n    exports.Spawner = Spawner;\r\n});\r\ndefine("e7a6c753-ea84-4c8e-bb94-4523407a5d55/game", ["require", "exports"], function (require, exports) {\r\n    "use strict";\r\n    Object.defineProperty(exports, "__esModule", { value: true });\r\n});\r\n//import MessageBubble, { Props } from \'./item\'\r\n//\r\n//const post = new MessageBubble()\r\n//const spawner = new Spawner<Props>(post)\r\n//\r\n//spawner.spawn(\'bubble\', new Transform({ position: new Vector3(4, 1, 8) }), {\r\n//  text: \'eeee wacho\',\r\n//  fontSize: 20\r\n//})\r\n//\r\ndefine("e7a6c753-ea84-4c8e-bb94-4523407a5d55/item", ["require", "exports", \"e7a6c753-ea84-4c8e-bb94-4523407a5d55/bubble\"], function (require, exports, bubble_1) {\r\n    "use strict";\r\n    Object.defineProperty(exports, "__esModule", { value: true });\r\n    var MessageBubble = /** @class */ (function () {\r\n        function MessageBubble() {\r\n            this.openClip = new AudioClip(\'e7a6c753-ea84-4c8e-bb94-4523407a5d55/sounds/MessageBubble.mp3\');\r\n        }\r\n        MessageBubble.prototype.init = function () {\r\n            engine.addSystem(new bubble_1.BubbleSystem());\r\n        };\r\n        MessageBubble.prototype.toggle = function (bubble, text, value, playSound) {\r\n            if (playSound === void 0) { playSound = true; }\r\n            var bubbleData = bubble.getComponent(bubble_1.MessageBubbleComponent);\r\n            if (bubbleData.isOpen === value)\r\n                return;\r\n            if (playSound) {\r\n                var source = new AudioSource(this.openClip);\r\n                bubble.addComponentOrReplace(source);\r\n                source.playing = true;\r\n            }\r\n            bubble.getComponent(Transform).rotation = bubbleData.rotation.clone();\r\n            bubbleData.isOpen = value;\r\n            bubbleData.transition = 0;\r\n            if (value) {\r\n                text.value = bubbleData.text.toString();\r\n            }\r\n            else {\r\n                text.value = \'\';\r\n            }\r\n        };\r\n        MessageBubble.prototype.spawn = function (host, props, channel) {\r\n            var _this = this;\r\n            var bubble = new Entity();\r\n            bubble.setParent(host);\r\n            bubble.addComponent(new GLTFShape(\'e7a6c753-ea84-4c8e-bb94-4523407a5d55/models/bubble/MessageBubble.glb\'));\r\n            bubble.addComponent(new Transform({\r\n                position: new Vector3(0, 0, 0),\r\n                scale: new Vector3(0.25, 0.25, 0.25)\r\n            }));\r\n            var bubbleData = new bubble_1.MessageBubbleComponent(channel, props.text, bubble.getComponent(Transform).rotation.clone());\r\n            bubble.addComponent(bubbleData);\r\n            var signText = new Entity();\r\n            signText.setParent(bubble);\r\n            var text = new TextShape(props.text);\r\n            text.fontSize = props.fontSize;\r\n            text.color = Color3.FromHexString(\'#242424\');\r\n            // text.outlineWidth = 0.4\r\n            // text.outlineColor = Color3.FromHexString(\'#8cfdff\')\r\n            text.width = 20;\r\n            text.height = 10;\r\n            text.hTextAlign = \'center\';\r\n            text.value = \'\';\r\n            signText.addComponent(text);\r\n            signText.addComponent(new Transform({\r\n                position: new Vector3(0.25, 0.45, -0.01),\r\n                rotation: Quaternion.Euler(0, 0, 0),\r\n                scale: new Vector3(0.05, 0.05, 0.05)\r\n            }));\r\n            bubble.addComponent(new OnPointerDown(function (e) {\r\n                _this.toggle(bubble, text, !bubbleData.isOpen, true);\r\n            }, {\r\n                button: ActionButton.POINTER,\r\n                hoverText: \'Open/Close\',\r\n                distance: 8\r\n            }));\r\n            // handle actions\r\n            channel.handleAction(\'open\', function (_a) {\r\n                var sender = _a.sender;\r\n                _this.toggle(bubble, text, true);\r\n            });\r\n            channel.handleAction(\'close\', function (_a) {\r\n                var sender = _a.sender;\r\n                _this.toggle(bubble, text, false);\r\n            });\r\n            channel.handleAction(\'changeText\', function (action) {\r\n                text.value = action.values.newText;\r\n                bubbleData.text = action.values.newText;\r\n            });\r\n            channel.request(\'getText\', function (signText) { return (bubbleData.text = signText); });\r\n            channel.reply(\'getText\', function () { return bubbleData.text; });\r\n        };\r\n        return MessageBubble;\r\n    }());\r\n    exports.default = MessageBubble;\r\n});\r\n');